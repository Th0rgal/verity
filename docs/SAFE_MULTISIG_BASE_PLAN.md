# Safe Multisig Base Proof Plan (Scaffold)

Goal: formally prove the latest Safe base contract from safe-smart-account, and
ensure generated bytecode matches the Solidity implementation.

## Pinned Upstream
- Repo: safe-fndn/safe-smart-account
- Release: v1.5.0
- Commit: dc437e8
- Base contract: contracts/Safe.sol (Safe)

## Current Scaffold
- EDSL placeholder: `DumbContracts/Examples/SafeMultisigBase.lean`
- Contract specs: `DumbContracts/Specs/SafeMultisigBase/Spec.lean`
- Invariants: `DumbContracts/Specs/SafeMultisigBase/Invariants.lean`
- EDSL proofs: `DumbContracts/Proofs/SafeMultisigBase/*`
- Compiler spec placeholder: `Compiler/Specs/SafeMultisigBase.lean`
- Spec correctness placeholder: `Compiler/Proofs/SpecCorrectness/SafeMultisigBase.lean`

## Next Steps
1. Copy the pinned upstream base contract source into
   `docs/safe-multisig-base/source/` (or another agreed location). (Done)
2. Define the exact storage layout and ABI for the base contract. (Storage layout done:
   `docs/safe-multisig-base/storage-layout.md`, ABI done and expanded to base interfaces:
   `docs/safe-multisig-base/abi.md`, EDSL slot constants done:
   `DumbContracts/Examples/SafeMultisigBase.lean`)
   - Baseline invariants (ownerCount > 0, threshold > 0, threshold â‰¤ ownerCount) captured in
     `DumbContracts/Specs/SafeMultisigBase/Invariants.lean`
3. Implement the base contract in the DumbContracts EDSL.
4. Write ContractSpec that mirrors the EDSL and Solidity behavior.
5. Prove EDSL semantics match ContractSpec (Layer 1).
6. Prove ContractSpec -> IR -> Yul preservation (Layers 2 and 3).
7. Compare produced bytecode with the Solidity compiler output and
   adjust the compiler if needed to ensure identical output.

## Notes
- Keep the EDSL spec human-readable and minimal.
- Prefer small, composable lemmas for ownership + threshold invariants.
- Document any trust assumptions explicitly.
- Source snapshot integrity:
  - `docs/safe-multisig-base/source/Safe.sol`
  - SHA256: `4b54dce0ad9d9c1264ecd5c146c82b7bc17d24f981bd42525487be3bf6a40366`
