# Research Log

## 2026-02-10
- Added `letSload` stdlib helper for caching a slot read via `let_`.
- Refactored `compareAndSwap` to use `letSload`.
- Added `initOnce` example (only initialize a zero slot) with SpecR + proofs.
- Added Foundry test for `initOnce`.
- Updated compiler entries + direct EVM asm for `initOnce`.
- Added `requireLt` stdlib helper to mirror `requireGt` for less-than guards.
- Refactored `setIfLess` to use `requireLt` instead of a manual `revertIf`.
- Added `setIfBetween` example (guarded store on `min < value < max`) with SpecR + proofs.
- Added Foundry test for `setIfBetween`.
- Updated compiler entries + direct EVM asm for `setIfBetween`.
- Added `revertIf` stdlib helper for guard-style reverts.
- Refactored `checkHealth` to use `revertIf`.
- Added `setIfLess` example (guarded store on `value < max`) with SpecR + proofs.
- Added Foundry test for `setIfLess`.
- Updated compiler entries + direct EVM asm for `setIfLess`.
- Added `sstoreAdd` stdlib helper to make slot increments less noisy.
- Added `bumpSlot` example (increment slot by one) with a basic Spec + proof.
- Refactored `addSlot` and `guardedAddSlot` to use `sstoreAdd`.
- Added Foundry test for `bumpSlot`.
- Updated compiler entries + direct EVM asm for `bumpSlot`.
- Added `requireGt` stdlib helper to reduce guard boilerplate.
- Added `setIfGreater` example (guarded store on `value > min`) with SpecR + proofs.
- Refactored `guardedAddSlot` to use `requireGt`.
- Added Foundry test for `setIfGreater`.
- Added `eq`/`neq` plus `requireEq`/`requireNeq` stdlib helpers.
- Added `compareAndSwap` example (guarded store on expected value match) with SpecR and proofs.
- Avoided double `sload` in `compareAndSwap` by caching the slot value with `let_` (prevents false reverts).
- Refactored `setNonZero` to use the new `requireNeq` helper.
- Updated compiler entries + direct EVM asm for `compareAndSwap`.
- Added Foundry test for `compareAndSwap`.

## 2026-02-09
- Added spec-style wrappers for storage and risk examples.
- Added `SpecR` (specs with explicit revert predicates) and proofs.
- Added token-style transfer `SpecR` + proofs (revert on zero address or low balance).
- Added sum-preservation lemma for transfer (distinct accounts).
- Added transfer locality lemma (other balances unchanged).
- Added transfer sum lemma for a list of non-updated accounts.
- Added transfer sum lemma for `(from :: to :: rest)` lists (sum preserved with `from/to` included).
- Added totalSupply slot model + lemma showing transfer does not modify totalSupply.
- Added supply conservation lemma for a tracked list (`from :: to :: rest`) under transfer.
- Added transfer self-case lemma (when `from = to`, exec is a no-op after both writes).
- Added sequential-read transfer spec (`transferSpecRSeq`) to match exec semantics.
- Proved `transferSpecRSeq` meets execution and self-transfer is a no-op under the sequential spec.
- Added a self-transfer counterexample lemma showing `transferSpecR` cannot hold for `from = to` when `amount > 0`.
- Proved sequential transfer spec is equivalent to old-state spec when `from ≠ to`.
- Added a guarded transfer spec (`transferSpecRNoSelf`) and proof it meets execution when `from ≠ to`.
- Added a small counterexample lemma showing list-based supply accounting breaks with duplicates (motivation for sets/dedup).
- Split `Examples.lean` into multiple focused example modules.
- Added a minimal EDSL stdlib with common helpers (`require`, `unless`, `assert`, slot helpers, var/lit helpers).
- Added `sloadVar`/`sstoreVar` stdlib helpers for variable slot access.
- Added a tiny `maxStore` example (store max(a,b) into a slot) plus selector + Foundry test.
- Added a `requireNonZero` helper plus a tiny `setNonZero` example + Foundry test.
- Updated direct EVM asm to include `setNonZero` and force label pushes to `PUSH2` so bytecode matches solc output.
- Refreshed external landscape notes (Act, Scribble, Certora, SMTChecker, KEVM, Kontrol).
- Added selector map artifact (fixed + ABI keccak).
- Fixed Foundry selectors and moved to Shanghai EVM.
- Added Foundry tests for generated contracts.
- Compressed docs + tightened minimal frontend.
- Scanned external tooling landscape (Act, Scribble, Certora, SMTChecker, KEVM/Kontrol, VerX, Move Prover).
