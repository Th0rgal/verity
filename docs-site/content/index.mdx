---
title: Dumb Contracts
description: Minimal Lean 4 EDSL for writing and formally verifying smart contracts
---

# Dumb Contracts

A minimal Lean 4 embedded DSL for writing and formally verifying smart contracts.

The core is 212 lines of Lean. It models contract state, storage operations, and `require` guards using an explicit success/revert result type (`ContractResult`). 7 example contracts are implemented and verified with 252 machine-checked proofs. No `sorry`, no axioms.

## How it works

Contracts are Lean functions from `ContractState` to `ContractResult`. The `ContractResult` type has two constructors: `success` (with a value and updated state) and `revert` (with an error message and unchanged state). A custom `bind` short-circuits on revert, so do-notation works like Solidity.

```lean
-- A contract that mints tokens, guarded by onlyOwner
def mint (to : Address) (amount : Uint256) : Contract Unit := do
  onlyOwner
  let currentBalance ← getMapping balances to
  setMapping balances to (currentBalance + amount)
  let currentSupply ← getStorage totalSupply
  setStorage totalSupply (currentSupply + amount)

-- Proven: mint increases the recipient's balance by the minted amount
theorem mint_increases_balance (s : ContractState) (to : Address) (amount : Uint256)
  (h_owner : s.sender = s.storageAddr 0) :
  let s' := ((mint to amount).run s).snd
  s'.storageMap 1 to = s.storageMap 1 to + amount
```

## Contracts

| Contract | Theorems | What's verified |
|----------|----------|-----------------|
| SimpleStorage | 19 | Store/retrieve roundtrip, state isolation |
| Counter | 29 | Arithmetic, composition, decrement-at-zero |
| Owned | 22 | Access control, ownership transfer |
| SimpleToken | 64 | Mint/transfer, supply conservation, storage isolation |
| OwnedCounter | 34 | Cross-pattern composition, ownership transfer lockout |
| Ledger | 40 | Deposit/withdraw/transfer, balance conservation |
| SafeCounter | 30 | Overflow/underflow revert proofs |
| Stdlib/Math | 14 | safeMul/safeDiv correctness |

## Documentation

- **[Verification](/verification)** - All 252 proven theorems, listed per contract
- **[Examples](/examples)** - The 7 contracts and what they demonstrate
- **[Core Architecture](/core)** - How the 212-line core works
- **[Research Log](/research)** - Design history across 7 implementation iterations
- **[Iteration Summaries](/iterations)** - Detailed notes per iteration

## For AI agents

This documentation is available in machine-readable form:
- Request any page with `.md` extension or `?format=md`
- All docs concatenated at `/api/docs/_all`
- Document index at `/api/docs/_index`
- AI user agents automatically get markdown

## Links

- [GitHub Repository](https://github.com/Th0rgal/dumbcontracts)
